<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Anki卡牌数据结构和关键配置 | 叶落花开的博客</title><meta name="keywords" content="Anki"><meta name="author" content="叶落花开"><meta name="copyright" content="叶落花开"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="以下Anki卡牌数据结构和关键配置信息是采集自Github，记录到这里方便查看。">
<meta property="og:type" content="article">
<meta property="og:title" content="Anki卡牌数据结构和关键配置">
<meta property="og:url" content="https://www.yeluohuakai.com/posts/2022/11/284ccda.html">
<meta property="og:site_name" content="叶落花开的博客">
<meta property="og:description" content="以下Anki卡牌数据结构和关键配置信息是采集自Github，记录到这里方便查看。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-11-26T01:04:00.000Z">
<meta property="article:modified_time" content="2022-11-26T01:10:37.375Z">
<meta property="article:author" content="叶落花开">
<meta property="article:tag" content="Anki">
<meta name="twitter:card" content="summary"><link rel="shortcut icon" href="/favicon.png"><link rel="canonical" href="https://www.yeluohuakai.com/posts/2022/11/284ccda"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?2f8a615b51582cf280e790200f3527e6";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-LB2ZMBR4ZN"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-LB2ZMBR4ZN');
</script><script>(function(){
var el = document.createElement("script");
el.src = "https://lf1-cdn-tos.bytegoofy.com/goofy/ttzz/push.js?18da2b25537eeea1b5c8819ad9a03fc2279abb7e5ff9fdb01a2409cbd77b8f1db3e414cba65c376eba389ba56d9ee0846cad2206506a6529fe6ee21a7373effb434c445cf6444b10ea9756ea44e128a6";
el.id = "ttzz";
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(el, s);
})(window)
</script><script async="async" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6673854567363222"></script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":false,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://fastly.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://fastly.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Anki卡牌数据结构和关键配置',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-26 09:10:37'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/index_code.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/loading.gif" data-original="/img/ava.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">225</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">83</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://support.qq.com/product/377343"><i class="fa-fw fa fa-paper-plane"></i><span> 反馈</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">叶落花开的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://support.qq.com/product/377343"><i class="fa-fw fa fa-paper-plane"></i><span> 反馈</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Anki卡牌数据结构和关键配置</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-26T01:04:00.000Z" title="发表于 2022-11-26 09:04:00">2022-11-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-26T01:10:37.375Z" title="更新于 2022-11-26 09:10:37">2022-11-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/IT%E6%8A%80%E6%9C%AF/">IT技术</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/IT%E6%8A%80%E6%9C%AF/Anki/">Anki</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span id="" data-flag-title="Anki卡牌数据结构和关键配置"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="twikoo_visitors"></span></span></div></div></div><article class="post-content" id="article-container"><p>以下Anki卡牌数据结构和关键配置信息是采集自Github，记录到这里方便查看。</p>
<span id="more"></span>

<h3 id="Cards"><a href="#Cards" class="headerlink" title="Cards"></a>Cards</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- Cards are what you review. </span><br><span class="line">-- There can be multiple cards for each note, as determined by the Template.</span><br><span class="line">CREATE TABLE cards (</span><br><span class="line">    id              integer primary key,</span><br><span class="line">      -- the epoch milliseconds of when the card was created</span><br><span class="line">    nid             integer not null,--    </span><br><span class="line">      -- notes.id</span><br><span class="line">    did             integer not null,</span><br><span class="line">      -- deck id (available in col table)</span><br><span class="line">    ord             integer not null,</span><br><span class="line">      -- ordinal : identifies which of the card templates or cloze deletions it corresponds to </span><br><span class="line">      --   for card templates, valid values are from 0 to num templates - 1</span><br><span class="line">      --   for cloze deletions, valid values are from 0 to max cloze index - 1 (they&#x27;re 0 indexed despite the first being called `c1`)</span><br><span class="line">    mod             integer not null,</span><br><span class="line">      -- modification time as epoch seconds</span><br><span class="line">    usn             integer not null,</span><br><span class="line">      -- update sequence number : used to figure out diffs when syncing. </span><br><span class="line">      --   value of -1 indicates changes that need to be pushed to server. </span><br><span class="line">      --   usn &lt; server usn indicates changes that need to be pulled from server.</span><br><span class="line">    type            integer not null,</span><br><span class="line">      -- 0=new, 1=learning, 2=review, 3=relearning</span><br><span class="line">    queue           integer not null,</span><br><span class="line">      -- -3=user buried(In scheduler 2),</span><br><span class="line">      -- -2=sched buried (In scheduler 2), </span><br><span class="line">      -- -2=buried(In scheduler 1),</span><br><span class="line">      -- -1=suspended,</span><br><span class="line">      -- 0=new, 1=learning, 2=review (as for type)</span><br><span class="line">      -- 3=in learning, next rev in at least a day after the previous review</span><br><span class="line">      -- 4=preview</span><br><span class="line">    due             integer not null,</span><br><span class="line">     -- Due is used differently for different card types: </span><br><span class="line">     --   new: note id or random int</span><br><span class="line">     --   due: integer day, relative to the collection&#x27;s creation time</span><br><span class="line">     --   learning: integer timestamp in second</span><br><span class="line">    ivl             integer not null,</span><br><span class="line">      -- interval (used in SRS algorithm). Negative = seconds, positive = days</span><br><span class="line">    factor          integer not null,</span><br><span class="line">      -- The ease factor of the card in permille (parts per thousand). If the ease factor is 2500, the card’s interval will be multiplied by 2.5 the next time you press Good.</span><br><span class="line">    reps            integer not null,</span><br><span class="line">      -- number of reviews</span><br><span class="line">    lapses          integer not null,</span><br><span class="line">      -- the number of times the card went from a &quot;was answered correctly&quot; </span><br><span class="line">      --   to &quot;was answered incorrectly&quot; state</span><br><span class="line">    left            integer not null,</span><br><span class="line">      -- of the form a*1000+b, with:</span><br><span class="line">      -- a the number of reps left today</span><br><span class="line">      -- b the number of reps left till graduation</span><br><span class="line">      -- for example: &#x27;2004&#x27; means 2 reps left today and 4 reps till graduation</span><br><span class="line">    odue            integer not null,</span><br><span class="line">      -- original due: In filtered decks, it&#x27;s the original due date that the card had before moving to filtered.</span><br><span class="line">                    -- If the card lapsed in scheduler1, then it&#x27;s the value before the lapse. (This is used when switching to scheduler 2. At this time, cards in learning becomes due again, with their previous due date)</span><br><span class="line">                    -- In any other case it&#x27;s 0.</span><br><span class="line">    odid            integer not null,</span><br><span class="line">      -- original did: only used when the card is currently in filtered deck</span><br><span class="line">    flags           integer not null,</span><br><span class="line">      -- an integer. This integer mod 8 represents a &quot;flag&quot;, which can be see in browser and while reviewing a note. Red 1, Orange 2, Green 3, Blue 4, no flag: 0. This integer divided by 8 represents currently nothing</span><br><span class="line">    data            text not null</span><br><span class="line">      -- currently unused</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- col contains a single row that holds various information about the collection</span><br><span class="line">CREATE TABLE col (</span><br><span class="line">    id              integer primary key,</span><br><span class="line">      -- arbitrary number since there is only one row</span><br><span class="line">    crt             integer not null,</span><br><span class="line">      -- timestamp of the creation date in second. It&#x27;s correct up to the day. For V1 scheduler, the hour corresponds to starting a new day. By default, new day is 4.</span><br><span class="line">    mod             integer not null,</span><br><span class="line">      -- last modified in milliseconds</span><br><span class="line">    scm             integer not null,</span><br><span class="line">      -- schema mod time: time when &quot;schema&quot; was modified. </span><br><span class="line">      --   If server scm is different from the client scm a full-sync is required</span><br><span class="line">    ver             integer not null,</span><br><span class="line">      -- version</span><br><span class="line">    dty             integer not null,</span><br><span class="line">      -- dirty: unused, set to 0</span><br><span class="line">    usn             integer not null,</span><br><span class="line">      -- update sequence number: used for finding diffs when syncing. </span><br><span class="line">      --   See usn in cards table for more details.</span><br><span class="line">    ls              integer not null,</span><br><span class="line">      -- &quot;last sync time&quot;</span><br><span class="line">    conf            text not null,</span><br><span class="line">      -- json object containing configuration options that are synced. Described below in &quot;configuration JSONObjects&quot;</span><br><span class="line">    models          text not null,</span><br><span class="line">      -- json object of json object(s) representing the models (aka Note types) </span><br><span class="line">      -- keys of this object are strings containing integers: &quot;creation time in epoch milliseconds&quot; of the models</span><br><span class="line">      -- values of this object are other json objects of the form described below in &quot;Models JSONObjects&quot;</span><br><span class="line">    decks           text not null,</span><br><span class="line">      -- json object of json object(s) representing the deck(s)</span><br><span class="line">      -- keys of this object are strings containing integers: &quot;deck creation time in epoch milliseconds&quot; for most decks, &quot;1&quot; for the default deck</span><br><span class="line">      -- values of this object are other json objects of the form described below in &quot;Decks JSONObjects&quot;</span><br><span class="line">    dconf           text not null,</span><br><span class="line">      -- json object of json object(s) representing the options group(s) for decks</span><br><span class="line">      -- keys of this object are strings containing integers: &quot;options group creation time in epoch milliseconds&quot; for most groups, &quot;1&quot; for the default option group</span><br><span class="line">      -- values of this object are other json objects of the form described below in &quot;DConf JSONObjects&quot;</span><br><span class="line">    tags            text not null</span><br><span class="line">      -- a cache of tags used in the collection (This list is displayed in the browser. Potentially at other place)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="Graves"><a href="#Graves" class="headerlink" title="Graves"></a>Graves</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- Contains deleted cards, notes, and decks that need to be synced. </span><br><span class="line">-- usn should be set to -1, </span><br><span class="line">-- oid is the original id.</span><br><span class="line">-- type: 0 for a card, 1 for a note and 2 for a deck</span><br><span class="line">CREATE TABLE graves (</span><br><span class="line">    usn             integer not null,</span><br><span class="line">    oid             integer not null,</span><br><span class="line">    type            integer not null</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- Notes contain the raw information that is formatted into a number of cards</span><br><span class="line">-- according to the models</span><br><span class="line">CREATE TABLE notes (</span><br><span class="line">    id              integer primary key,</span><br><span class="line">      -- epoch milliseconds of when the note was created</span><br><span class="line">    guid            text not null,</span><br><span class="line">      -- globally unique id, almost certainly used for syncing</span><br><span class="line">    mid             integer not null,</span><br><span class="line">      -- model id</span><br><span class="line">    mod             integer not null,</span><br><span class="line">      -- modification timestamp, epoch seconds</span><br><span class="line">    usn             integer not null,</span><br><span class="line">      -- update sequence number: for finding diffs when syncing.</span><br><span class="line">      --   See the description in the cards table for more info</span><br><span class="line">    tags            text not null,</span><br><span class="line">      -- space-separated string of tags. </span><br><span class="line">      --   includes space at the beginning and end, for LIKE &quot;% tag %&quot; queries</span><br><span class="line">    flds            text not null,</span><br><span class="line">      -- the values of the fields in this note. separated by 0x1f (31) character.</span><br><span class="line">    sfld            integer not null,</span><br><span class="line">      -- sort field: used for quick sorting and duplicate check. The sort field is an integer so that when users are sorting on a field that contains only numbers, they are sorted in numeric instead of lexical order. Text is stored in this integer field.</span><br><span class="line">    csum            integer not null,</span><br><span class="line">      -- field checksum used for duplicate check.</span><br><span class="line">      --   integer representation of first 8 digits of sha1 hash of the first field</span><br><span class="line">    flags           integer not null,</span><br><span class="line">      -- unused</span><br><span class="line">    data            text not null</span><br><span class="line">      -- unused</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="Review-Log"><a href="#Review-Log" class="headerlink" title="Review Log"></a>Review Log</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- revlog is a review history; it has a row for every review you&#x27;ve ever done!</span><br><span class="line">CREATE TABLE revlog (</span><br><span class="line">    id              integer primary key,</span><br><span class="line">       -- epoch-milliseconds timestamp of when you did the review</span><br><span class="line">    cid             integer not null,</span><br><span class="line">       -- cards.id</span><br><span class="line">    usn             integer not null,</span><br><span class="line">        -- update sequence number: for finding diffs when syncing. </span><br><span class="line">        --   See the description in the cards table for more info</span><br><span class="line">    ease            integer not null,</span><br><span class="line">       -- which button you pushed to score your recall. </span><br><span class="line">       -- review:  1(wrong), 2(hard), 3(ok), 4(easy)</span><br><span class="line">       -- learn/relearn:   1(wrong), 2(ok), 3(easy)</span><br><span class="line">    ivl             integer not null,</span><br><span class="line">       -- interval (i.e. as in the card table)</span><br><span class="line">    lastIvl         integer not null,</span><br><span class="line">       -- last interval (i.e. the last value of ivl. Note that this value is not necessarily equal to the actual interval between this review and the preceding review)</span><br><span class="line">    factor          integer not null,</span><br><span class="line">      -- factor</span><br><span class="line">    time            integer not null,</span><br><span class="line">       -- how many milliseconds your review took, up to 60000 (60s)</span><br><span class="line">    type            integer not null</span><br><span class="line">       --  0=learn, 1=review, 2=relearn, 3=cram</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="Indexes"><a href="#Indexes" class="headerlink" title="Indexes"></a>Indexes</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE INDEX ix_cards_nid on cards (nid);</span><br><span class="line">CREATE INDEX ix_cards_sched on cards (did, queue, due);</span><br><span class="line">CREATE INDEX ix_cards_usn on cards (usn);</span><br><span class="line">CREATE INDEX ix_notes_csum on notes (csum);</span><br><span class="line">CREATE INDEX ix_notes_usn on notes (usn);</span><br><span class="line">CREATE INDEX ix_revlog_cid on revlog (cid);</span><br><span class="line">CREATE INDEX ix_revlog_usn on revlog (usn);</span><br></pre></td></tr></table></figure>
<h3 id="Models-JSONObjects"><a href="#Models-JSONObjects" class="headerlink" title="Models JSONObjects"></a>Models JSONObjects</h3><p>Here is an annotated description of the JSONObjects in the models field of the col table. Each object is the value of a key that’s a model id (epoch time in milliseconds):</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;model id (epoch time in milliseconds)&quot; :</span><br><span class="line">  &#123;</span><br><span class="line">    css : &quot;CSS, shared for all templates&quot;,</span><br><span class="line">    did :</span><br><span class="line">        &quot;Long specifying the id of the deck that cards are added to by default&quot;,</span><br><span class="line">    flds : [</span><br><span class="line">             &quot;JSONArray containing object for each field in the model as follows:&quot;,</span><br><span class="line">             &#123;</span><br><span class="line">               font : &quot;display font&quot;,</span><br><span class="line">               media : &quot;array of media. appears to be unused&quot;,</span><br><span class="line">               name : &quot;field name&quot;,</span><br><span class="line">               ord : &quot;ordinal of the field - goes from 0 to num fields -1&quot;,</span><br><span class="line">               rtl : &quot;boolean, right-to-left script&quot;,</span><br><span class="line">               size : &quot;font size&quot;,</span><br><span class="line">               sticky : &quot;sticky fields retain the value that was last added </span><br><span class="line">                           when adding new notes&quot;</span><br><span class="line">             &#125;</span><br><span class="line">           ],</span><br><span class="line">    id : &quot;model ID, matches notes.mid&quot;,</span><br><span class="line">    latexPost : &quot;String added to end of LaTeX expressions (usually \\end&#123;document&#125;)&quot;,</span><br><span class="line">    latexPre : &quot;preamble for LaTeX expressions&quot;,</span><br><span class="line">    mod : &quot;modification time in seconds&quot;,</span><br><span class="line">    name : &quot;model name&quot;,</span><br><span class="line">    req : [</span><br><span class="line">            &quot;req is unused in modern clients. May exist for backwards compatibility. </span><br><span class="line">             https://forums.ankiweb.net/t/is-req-still-used-or-present/9977</span><br><span class="line">             AnkiDroid 2.14 uses it, AnkiDroid 2.15 does not use it but still generates it.</span><br><span class="line">             Array of arrays describing, for each template T, which fields are required to generate T.</span><br><span class="line">             The array is of the form [T,string,list], where:</span><br><span class="line">             -  T is the ordinal of the template. </span><br><span class="line">             - The string is &#x27;none&#x27;, &#x27;all&#x27; or &#x27;any&#x27;. </span><br><span class="line">             - The list contains ordinal of fields, in increasing order.</span><br><span class="line">             The meaning is as follows:</span><br><span class="line">             - if the string is &#x27;none&#x27;, then no cards are generated for this template. The list should be empty.</span><br><span class="line">             - if the string is &#x27;all&#x27; then the card is generated only if each field of the list are filled</span><br><span class="line">             - if the string is &#x27;any&#x27;, then the card is generated if any of the field of the list is filled.</span><br><span class="line"></span><br><span class="line">             The algorithm to decide how to compute req from the template is explained on: </span><br><span class="line">             https://github.com/Arthur-Milchior/anki/blob/commented/documentation//templates_generation_rules.md&quot;</span><br><span class="line">          ],</span><br><span class="line">    sortf : &quot;Integer specifying which field is used for sorting in the browser&quot;,</span><br><span class="line">    tags : &quot;Anki saves the tags of the last added note to the current model, use an empty array []&quot;,</span><br><span class="line">    tmpls : [</span><br><span class="line">              &quot;JSONArray containing object of CardTemplate for each card in model&quot;,</span><br><span class="line">              &#123;</span><br><span class="line">                afmt : &quot;answer template string&quot;,</span><br><span class="line">                bafmt : &quot;browser answer format: </span><br><span class="line">                          used for displaying answer in browser&quot;,</span><br><span class="line">                bqfmt : &quot;browser question format: </span><br><span class="line">                          used for displaying question in browser&quot;,</span><br><span class="line">                did : &quot;deck override (null by default)&quot;,</span><br><span class="line">                name : &quot;template name&quot;,</span><br><span class="line">                ord : &quot;template number, see flds&quot;,</span><br><span class="line">                qfmt : &quot;question format string&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            ],</span><br><span class="line">    type : &quot;Integer specifying what type of model. 0 for standard, 1 for cloze&quot;,</span><br><span class="line">    usn : &quot;usn: Update sequence number: used in same way as other usn vales in db&quot;,</span><br><span class="line">    vers : &quot;Legacy version number (unused), use an empty array []&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Decks-JSONObjects"><a href="#Decks-JSONObjects" class="headerlink" title="Decks JSONObjects"></a>Decks JSONObjects</h3><p>Here is an annotated description of the JSONObjects in the decks field of the col table:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;deck id (creation time in epoch milliseconds for most decks, &#x27;1&#x27; for the default deck)&quot;</span><br><span class="line">  &#123;</span><br><span class="line">    name: &quot;name of deck&quot;, </span><br><span class="line">    extendRev: &quot;extended review card limit (for custom study)</span><br><span class="line">                Potentially absent, in this case it&#x27;s considered to be 10 by aqt.customstudy&quot;, </span><br><span class="line">    usn: &quot;usn: Update sequence number: used in same way as other usn vales in db&quot;, </span><br><span class="line">    collapsed: &quot;true when deck is collapsed&quot;, </span><br><span class="line">    browserCollapsed: &quot;true when deck collapsed in browser&quot;, </span><br><span class="line">    newToday/revToday/lrnToday : two number array.</span><br><span class="line">                                 First one is the number of days that have passed between the collection was created and the deck was last updated</span><br><span class="line">                                 The second one is equal to the number of cards seen today in this deck minus the number of new cards in custom study today.</span><br><span class="line">                                 BEWARE, it&#x27;s changed in anki.sched(v2).Scheduler._updateStats and anki.sched(v2).Scheduler._updateCutoff.update  but can&#x27;t be found by grepping &#x27;newToday&#x27;, because it&#x27;s instead written as type+&quot;Today&quot; with type which may be new/rev/lrnToday    </span><br><span class="line">    timeToday: &quot;two number array used somehow for custom study. Currently unused in the code&quot;, </span><br><span class="line">    dyn: &quot;1 if dynamic (AKA filtered) deck&quot;, </span><br><span class="line">    extendNew: &quot;extended new card limit (for custom study). </span><br><span class="line">                Potentially absent, in this case it&#x27;s considered to be 10 by aqt.customstudy&quot;, </span><br><span class="line">    conf: &quot;id of option group from dconf in `col` table. Or absent if the deck is dynamic. </span><br><span class="line">          Its absent in filtered deck&quot;, </span><br><span class="line">    id: &quot;deck ID (automatically generated long)&quot;, </span><br><span class="line">    mod: &quot;last modification time&quot;, </span><br><span class="line">    desc: &quot;deck description&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="DConf-JSONObjects"><a href="#DConf-JSONObjects" class="headerlink" title="DConf JSONObjects"></a>DConf JSONObjects</h3><p>Here is an annotated description of the JSONObjects in the dconf field of the col.decks table:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;deck config id (creation time in epoch milliseconds for most option groups, &#x27;1&#x27; for the default option group)&quot; :</span><br><span class="line">  &#123;</span><br><span class="line">        autoplay : &quot;whether the audio associated to a question should be</span><br><span class="line">played when the question is shown&quot;</span><br><span class="line">        dyn : &quot;Whether this deck is dynamic. Not present by default in decks.py&quot;</span><br><span class="line">        id : &quot;deck ID (automatically generated long). Not present by default in decks.py&quot;</span><br><span class="line">        lapse : &#123;</span><br><span class="line">            &quot;The configuration for lapse cards.&quot;</span><br><span class="line">            delays : &quot;The list of successive delay between the learning steps of the new cards, as explained in the manual.&quot;</span><br><span class="line">            leechAction : &quot;What to do to leech cards. 0 for suspend, 1 for mark. Numbers according to the order in which the choices appear in aqt/dconf.ui&quot;</span><br><span class="line">            leechFails : &quot;the number of lapses authorized before doing leechAction.&quot;</span><br><span class="line">            minInt: &quot;a lower limit to the new interval after a leech&quot;</span><br><span class="line">            mult : &quot;percent by which to multiply the current interval when a card goes has lapsed&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        maxTaken : &quot;The number of seconds after which to stop the timer&quot;</span><br><span class="line">        mod : &quot;Last modification time&quot;</span><br><span class="line">        name : &quot;The name of the configuration&quot;</span><br><span class="line">        new : &#123;</span><br><span class="line">            &quot;The configuration for new cards.&quot;</span><br><span class="line">            bury : &quot;Whether to bury cards related to new cards answered&quot;</span><br><span class="line">            delays : &quot;The list of successive delay between the learning steps of the new cards, as explained in the manual.&quot;</span><br><span class="line">            initialFactor : &quot;The initial ease factor&quot;</span><br><span class="line">            ints : &quot;The list of delays according to the button pressed while leaving the learning mode. Good, easy and unused. In the GUI, the first two elements corresponds to Graduating Interval and Easy interval&quot;</span><br><span class="line">            order : &quot;In which order new cards must be shown. NEW_CARDS_RANDOM = 0 and NEW_CARDS_DUE = 1.&quot;</span><br><span class="line">            perDay : &quot;Maximal number of new cards shown per day.&quot;</span><br><span class="line">            separate : &quot;Seems to be unused in the code.&quot;</span><br><span class="line">                </span><br><span class="line">        &#125;</span><br><span class="line">        replayq : &quot;whether the audio associated to a question should be played when the answer is shown&quot;</span><br><span class="line">        rev : &#123;</span><br><span class="line">            &quot;The configuration for review cards.&quot;</span><br><span class="line">            bury : &quot;Whether to bury cards related to new cards answered&quot;</span><br><span class="line">            ease4 : &quot;the number to add to the easyness when the easy button is pressed&quot;</span><br><span class="line">            fuzz : &quot;The new interval is multiplied by a random number between -fuzz and fuzz&quot;</span><br><span class="line">            ivlFct : &quot;multiplication factor applied to the intervals Anki generates&quot;</span><br><span class="line">            maxIvl : &quot;the maximal interval for review&quot;</span><br><span class="line">            minSpace : &quot;not currently used according to decks.py code&#x27;s comment&quot;</span><br><span class="line">            perDay : &quot;Numbers of cards to review per day&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        timer : &quot;whether timer should be shown (1) or not (0)&quot;</span><br><span class="line">        usn : &quot;See usn in cards table for details.&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="configuration-JSONObject"><a href="#configuration-JSONObject" class="headerlink" title="configuration JSONObject"></a>configuration JSONObject</h3><p>Here is an annotated description of the JSONObject in the conf field of the col table when the collection is started. More values may be added to it by any add-on. Unlike the models, decks, and dconf JSONObjects, there should be only one conf JSONObject per collection.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;curDeck&quot;: &quot;The id (as int) of the last deck selected (during review, adding card, changing the deck of a card)&quot;,</span><br><span class="line">    &quot;activeDecks&quot;: &quot;The list containing the current deck id and its descendant (as ints)&quot;,</span><br><span class="line">    &quot;newSpread&quot;: &quot;In which order to view to review the cards. This can be selected in Preferences&gt;Basic. Possible values are:</span><br><span class="line">      0 -- NEW_CARDS_DISTRIBUTE (Mix new cards and reviews)</span><br><span class="line">      1 -- NEW_CARDS_LAST (see new cards after review)</span><br><span class="line">      2 -- NEW_CARDS_FIRST (See new card before review)&quot;,</span><br><span class="line">    &quot;collapseTime&quot;: &quot;&#x27;Preferences&gt;Basic&gt;Learn ahead limit&#x27;*60. If there is no more card to review now but next card in learning is in less than collapseTime second, show it now.</span><br><span class="line">    If there are no other card to review, then we can review cards in learning in advance if they are due in less than this number of seconds.&quot;,</span><br><span class="line">    &quot;timeLim&quot;: &quot;&#x27;Preferences&gt;Basic&gt;Timebox time limit&#x27;*60. Each time this number of second elapse, anki tell you how many card you reviewed.&quot;,</span><br><span class="line">    &quot;estTimes&quot;: &quot;&#x27;Preferences&gt;Basic&gt;Show next review time above answer buttons&#x27;. A Boolean.&quot;</span><br><span class="line">    &quot;dueCounts&quot;: &quot;&#x27;Preferences&gt;Basic&gt;Show remaining card count during review&#x27;. A Boolean.&quot;</span><br><span class="line">    &quot;curModel&quot;: &quot;Id (as string) of the last note type (a.k.a. model) used (i.e. either when creating a note, or changing the note type of a note).&quot;,</span><br><span class="line">    &quot;nextPos&quot;: &quot;This is the highest value of a due value of a new card. It allows to decide the due number to give to the next note created. (This is useful to ensure that cards are seen in order in which they are added.&quot;,</span><br><span class="line">    &quot;sortType&quot;: &quot;A string representing how the browser must be sorted. Its value should be one of the possible value of &#x27;aqt.browsers.DataModel.activeCols&#x27; (or equivalently of &#x27;activeCols&#x27;  but not any of (&#x27;question&#x27;, &#x27;answer&#x27;, &#x27;template&#x27;, &#x27;deck&#x27;, &#x27;note&#x27;, &#x27;noteTags&#x27;)&quot;,</span><br><span class="line">    &quot;sortBackwards&quot;: &quot;A Boolean stating whether the browser sorting must be in increasing or decreasing order&quot;,</span><br><span class="line">    &quot;addToCur&quot;: &quot;A Boolean. True for &#x27;When adding, default to current deck&#x27; in Preferences&gt;Basic. False for &#x27;Change deck depending on note type&#x27;.&quot;,</span><br><span class="line">    &quot;dayLearnFirst&quot;: &quot;A Boolean. It corresponds to the option &#x27;Show learning cards with larger steps before reviews&#x27;. But this option does not seems to appear in the preference box&quot;,</span><br><span class="line">    &quot;newBury&quot;: &quot;A Boolean. Always set to true and not read anywhere in the code but at the place where it is set to True if it is not already true. Hence probably quite useful.&quot;,</span><br><span class="line"></span><br><span class="line">    &quot;lastUnburied&quot;:&quot;The date of the last time the scheduler was initialized or reset. If it&#x27;s not today, then buried notes must be unburied. This is not in the json until scheduler is used once.&quot;,</span><br><span class="line">    &quot;activeCols&quot;:&quot;the list of name of columns to show in the browser. Possible values are listed in aqt.browser.Browser.setupColumns. They are:</span><br><span class="line">    &#x27;question&#x27; -- the browser column&#x27;Question&#x27;,</span><br><span class="line">    &#x27;answer&#x27; -- the browser column&#x27;Answer&#x27;,</span><br><span class="line">    &#x27;template&#x27; -- the browser column&#x27;Card&#x27;,</span><br><span class="line">    &#x27;deck&#x27; -- the browser column&#x27;Deck&#x27;,</span><br><span class="line">    &#x27;noteFld&#x27; -- the browser column&#x27;Sort Field&#x27;,</span><br><span class="line">    &#x27;noteCrt&#x27; -- the browser column&#x27;Created&#x27;,</span><br><span class="line">    &#x27;noteMod&#x27; -- the browser column&#x27;Edited&#x27;,</span><br><span class="line">    &#x27;cardMod&#x27; -- the browser column&#x27;Changed&#x27;,</span><br><span class="line">    &#x27;cardDue&#x27; -- the browser column&#x27;Due&#x27;,</span><br><span class="line">    &#x27;cardIvl&#x27; -- the browser column&#x27;Interval&#x27;,</span><br><span class="line">    &#x27;cardEase&#x27; -- the browser column&#x27;Ease&#x27;,</span><br><span class="line">    &#x27;cardReps&#x27; -- the browser column&#x27;Reviews&#x27;,</span><br><span class="line">    &#x27;cardLapses&#x27; -- the browser column&#x27;Lapses&#x27;,</span><br><span class="line">    &#x27;noteTags&#x27; -- the browser column&#x27;Tags&#x27;,</span><br><span class="line">    &#x27;note&#x27; -- the browser column&#x27;Note&#x27;,</span><br><span class="line">    The default columns are: noteFld, template, cardDue and deck</span><br><span class="line">    This is not in the json at creation. It&#x27;s added when the browser is open.</span><br><span class="line">     &quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>源自：<a target="_blank" rel="noopener" href="https://github.com/ankidroid/Anki-Android/wiki/Database-Structure">https://github.com/ankidroid/Anki-Android/wiki/Database-Structure</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">叶落花开</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.yeluohuakai.com/posts/2022/11/284ccda.html">https://www.yeluohuakai.com/posts/2022/11/284ccda.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.yeluohuakai.com" target="_blank">叶落花开的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Anki/">Anki</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://fastly.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/2022/11/d3ff87f2.html"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">anki如何设置三个时间间隔？</div></div></a></div><div class="next-post pull-right"><a href="/posts/2022/11/dd51b034.html"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Anki卡片的本质</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="/img/ava.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">叶落花开</div><div class="author-info__description">持续学习，记录后端技术、web技术，以及对认知、技术变现的思考。</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">225</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">83</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div></div></div><div class="card-widget user-map" id="user-map"><div class="item-headline"><i class="fas fa-link"></i><span>友情链接</span></div><div class="item-content"><ul class="entry"><li><a href="/bszs" title="各大高校博士招生信息">各大高校博士招生信息</a></li><li><a target="_blank" rel="noopener" href="https://www.xiaoxinsoft.com" title="小新软件服务">小新软件安装服务</a></li></ul></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cards"><span class="toc-number">1.</span> <span class="toc-text">Cards</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Collection"><span class="toc-number">2.</span> <span class="toc-text">Collection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Graves"><span class="toc-number">3.</span> <span class="toc-text">Graves</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Notes"><span class="toc-number">4.</span> <span class="toc-text">Notes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Review-Log"><span class="toc-number">5.</span> <span class="toc-text">Review Log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Indexes"><span class="toc-number">6.</span> <span class="toc-text">Indexes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Models-JSONObjects"><span class="toc-number">7.</span> <span class="toc-text">Models JSONObjects</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Decks-JSONObjects"><span class="toc-number">8.</span> <span class="toc-text">Decks JSONObjects</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DConf-JSONObjects"><span class="toc-number">9.</span> <span class="toc-text">DConf JSONObjects</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#configuration-JSONObject"><span class="toc-number">10.</span> <span class="toc-text">configuration JSONObject</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 叶落花开</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://fastly.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'freecloud-0gzubvbebcf38cf6',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.vemoji)'))
      }
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'freecloud-0gzubvbebcf38cf6',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      document.getElementById('twikoo-count').innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://fastly.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://fastly.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body></html>